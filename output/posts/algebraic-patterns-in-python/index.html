<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Algebraic patterns in Python | Adam Saleh's notes</title>
<link href="../../assets/css/theme.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/pure.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://asaleh.net/posts/algebraic-patterns-in-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Adam Saleh">
<link rel="next" href="../functor-pattern-in-python/" title="Functor pattern in Python" type="text/html">
<meta property="og:site_name" content="Adam Saleh's notes">
<meta property="og:title" content="Algebraic patterns in Python">
<meta property="og:url" content="http://asaleh.net/posts/algebraic-patterns-in-python/">
<meta property="og:description" content="What do I mean by algebra?¶When I say algebra, I don't think about implementing i.e. DSL for linear algebra in Python. I think about algebra in general as in &quot;a set of objects and a collection of oper">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-11T17:23:02+02:00">
</head>
<body>
<div class="body_container">
    <div id="header">
        <div class="site-name">
                <a id="logo" href="http://asaleh.net/"><h1>Adam Saleh's notes</h1></a>
        </div>

        <div id="nav-menu">
            <div class="bitcron_nav_container">
                <div class="bitcron_nav">
                    <div class="site_nav_wrap">
                        <ul class="site_nav sm sm-base">
<li><a href="../../pages/about/" class="nav__item">About</a></li>
            <li><a href="../../pages/algebraic-patterns/" class="nav__item">Algebraic patterns</a></li>
            <li><a href="../../archive.html" class="nav__item">Archive</a></li>
            <li><a href="../../categories/" class="nav__item">Tags</a></li>
            <li><a href="../../rss.xml" class="nav__item">RSS feed</a></li>

                            
                        </ul>
<div class="clear clear_nav_inline_end"></div>
                    </div>
                </div>
                <div class="clear clear_nav_end"></div>
            </div>
        </div>
    </div>
    <div id="layout">
        <div class="pure-g">
            <div class=" pure-u-24-24 pure-u-sm-24-24 pure-u-md-18-24 pure_cell">
                <div class="content_container">
                    <!--Body content-->
                    <div class="row">
                        
                        
<div class="post post-page">
    
    <header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Algebraic patterns in Python</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Adam Saleh
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-05-11T17:23:02+02:00" itemprop="datePublished" title="2017-05-11 17:23">2017-05-11 17:23</time></a></p>
            
        <p class="sourceline"><a href="index.ipynb" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="post-content">
        <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-do-I-mean-by-algebra?">What do I mean by algebra?<a class="anchor-link" href="#What-do-I-mean-by-algebra?">¶</a>
</h2>
<p>When I say algebra, I don't think about implementing i.e. DSL for linear algebra in Python. I think about algebra in general as in "a set of objects and a collection of operations on them".</p>
<p>I like algebras, when they are used in programming. Probably the most well-known is Relational Algebra. The object in Relational Algebra is a <em>relation</em>, with operations like <em>join</em>, <em>projection</em> and <em>union</em>. The nice thing about having something that works like an algebra is, that you always work with the same type of object, reusing the box of tools without breaking the flow.</p>
<!-- TEASER_END -->

<p>That is one of the reasons I like Pythons collections. Pythons sets and list actually have quite a nice algebra built around them.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Who-should-read-this?">Who should read this?<a class="anchor-link" href="#Who-should-read-this?">¶</a>
</h2>
<p>Anybody who is interested with using algebraic design patterns in Python.
I have three kinds of people in mind as my target audience.</p>
<ul>
<li>Me :-) Lets be clear, this is mostly a record for my future self, to remind me that I once understood something about this. </li>
<li>People familliar with these concepts in haskell, wanting to see them in dynamically typed language like Python</li>
<li>People interested in these algebraic patterns that know Python and don't have resources to learn i.e. haskell.</li>
</ul>
<p>If you are somebody interested, but wants to see these in haskell rather than python, go read <a href="https://bartoszmilewski.com/">Bartosz Milewski's Programming Cafe</a>, or <a href="http://www.haskellforall.com/">haskellforall by Gabriel Gonzalez</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[1]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>{1, 2, 3, 4, 5}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span> <span class="o">&amp;</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[2]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>{3}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span> <span class="o">-</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>{1, 2}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And what I really like is, that all the laws I remember about sets from discrete math still work. For example, with union as <code>|</code> and empty set as <code>set()</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="o">|</span><span class="nb">set</span><span class="p">()</span><span class="o">==</span><span class="nb">set</span><span class="p">()</span><span class="o">|</span><span class="n">a</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[4]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">}</span>
<span class="p">(</span><span class="n">a</span> <span class="o">|</span> <span class="n">b</span><span class="p">)</span> <span class="o">|</span> <span class="n">c</span> <span class="o">==</span> <span class="n">a</span> <span class="o">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">|</span> <span class="n">c</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[5]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>My personal preference is to use these math-like operators over calling methods on objects, even though methpd calls would produce the same result, and often would be more efficient</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>
<span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">a</span> <span class="o">==</span> <span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">3</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">4</span><span class="p">})</span> <span class="o">-</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[6]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To be honest, I probably would write this code with method calls, because they are more readable than operators:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">==</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">})</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="mi">2</span><span class="p">})</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[7]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I don't really want to have operators everywhere, what I want is composability. Now-days we might call this <em>fluent</em> interface, but I want to go one step further, I want the interface to conform to predefined set of rules.</p>
<p>This is what I mean when I say algebra:</p>
<ul>
<li>interfaces I work with <em>compose</em> with each other, they interoperate well, they are <em>fluent</em>
</li>
<li>the implementation is <em>lawful</em>, it conforms to predefined rules</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Why?">Why?<a class="anchor-link" href="#Why?">¶</a>
</h2>
<p>So I have been watching too many talks from Scala conferences and reading too many posts from haskell enthusiasts.
And now I envy them. Because I am mostly working with javascript and python and barely anybody even knows what <code>monad</code> <em>is</em>, while on the scala-side they are using co-free co-monads to implement cool, extensible DSLs.</p>
<p>Ok, there is fantasy-land and Ramda, but last time my colleague was trying to show off Ramda to the rest of the team, he mostly got puzzled looks from the most of them. And there isn't much in Python.</p>
<p>But I still want to try all of those cool things I see in the typed functional languages.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Algebraic-laws">Algebraic laws<a class="anchor-link" href="#Algebraic-laws">¶</a>
</h2>
<p>So, how might those predefined rules look like? For example lets have an binary operations $\circ$ and $\diamond$ some objects of some set $S$ that <em>will work with this operation</em>. Rules we might be interested in:</p>
<ul>
<li>
<p><strong>set is closed under the operation</strong>: 
$$\forall a,b \in S: a \circ b \in S$$</p>
</li>
<li>
<p><strong>operation is associative</strong>: 
$$\forall a,b,c \in S: a \circ (b \circ c) = (a \circ b) \circ c$$</p>
</li>
<li>
<p><strong>identity element exists</strong>:
$$ \exists e \in S, \forall a \in S: e \circ a = a = a \circ e$$</p>
</li>
<li>
<strong>inverse element exist</strong>:
$$ \forall a \in S  \exists b \in S: a \circ b = e = b \circ a$$</li>
<li>
<strong>operation is commutative</strong>:
$$\forall a,b \in S: a \circ b = b \circ a$$</li>
<li>
<p><strong>distributivity for $\circ$ and $\diamond$</strong>:
$$\forall a,b,c \in S: a \circ (b \diamond c) = a = (a \circ b) \diamond (a \circ c)$$</p>
</li>
<li>
<p><strong>absorbtion for $\circ$ and $\diamond$</strong>:
$$\forall a,b \in S: a \circ (a \diamond b) = a = a \diamond (a \circ b)$$</p>
</li>
<li>
<p><strong>idempotence</strong>
$$ \forall a \in S: a \circ a = a$$</p>
</li>
</ul>
<p>There are many known algebraic structures that are defined by adhering to some of these. For example:</p>
<ul>
<li>
<strong>monoid</strong> is a <em>set is closed under the operation</em>, that is <em>associative</em> and has <em>identity</em> element. Strings with concat operation, or lists with append are monoids.</li>
<li>
<strong>group</strong> is a <strong>monoid</strong>, where for every element in set <em>inverse</em> exists. These are i.e. integers with addition, more interestingly set of $n \times n$ invertible matrices with matrix multiplication operation.</li>
<li>
<strong>semilattice</strong> is is a <em>set is closed under the operation</em>, that is <em>associative</em>, <em>comutative</em> and <em>idempotent</em>. Integers and operation max(a,b), or min(a,b) form a semilattice</li>
<li>
<strong>bounded semilattice</strong> is a <strong>semilattice</strong> that is a <strong>monoid</strong>, for example, positive integers, max and 1.</li>
<li>
<strong>lattice</strong> is a set that has two operations that form a <strong>semilatice</strong>, where <em>absorbtion</em> for the two operations holds </li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Monoids-are-useful">Monoids are useful<a class="anchor-link" href="#Monoids-are-useful">¶</a>
</h2>
<p>There actually already is a pattern that is fairly similiar to monoid. It is the <a href="https://en.wikipedia.org/wiki/Null_Object_pattern">Null Object pattern</a>. But, because monoids have additional structure, with restctions on the operation to be <em>closed</em> and <em>associative</em>.</p>
<p>Strings with concat (and <code>""</code>), or lists with append (and <code>[]</code>), sets with union (and <code>set()</code>), dictionaries with union (and <code>{}</code>). What is even more interesting is that you can nest them, i.e. tuple of monoids is still monoid.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Latices-are-useful">Latices are useful<a class="anchor-link" href="#Latices-are-useful">¶</a>
</h2>
<p>Another of the things where this might be helpful, is in distributed systems. When i.e. doing a replication of some data over a wire:</p>
<ul>
<li>
<strong>your requests could arive in wrong order</strong>, but if updates would be <em>commutative</em>, this wouldn't be a problem </li>
<li>
<strong>Same bit of data might be re-sent multiple times</strong>, but if the updates would be <em>idempotent</em>, this wouldn't be a problem</li>
</ul>
<p>So we want a thing that is <em>commutative</em> and <em>idempotent</em> and that sounds like a <strong>lattice</strong>. There is <a href="https://www.youtube.com/watch?v=8dFO5Ir0xqY">a good talk by Lindsey Kuper</a> about their usefulness in parallel programming.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Combining-the-power-of-abstract-math-with-clarity-of-abstract-math">Combining the power of abstract math with clarity of abstract math<a class="anchor-link" href="#Combining-the-power-of-abstract-math-with-clarity-of-abstract-math">¶</a>
</h2>
<p>I think this nicely sums up the sentiment I have about using algebraic patterns. Because I like math. And I like the guarantees it gives me. That if I know that something is <em>commutative</em> I don't need to care if I do $a \circ b$ or $b \circ a$. That if something is <em>monoid</em> I can always initialize a value with its <em>identity element</em>.</p>
<p>On the other hand, I understand that it might bring additional complexity where it wasn't needed previously. Using <em>lattices</em> for your data makes things simpler when you start scaling across your cluster, but they might not support all the operations you need. Or you just don't have them in a library for your language and the one you need is just too complex to implement yourself.</p>
<p>So, lets keep that in mind. Next time, monoids?</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    <div class="postpromonav">
        <nav><ul class="pager hidden-print">
<li class="next">
                <a href="../functor-pattern-in-python/" rel="next" title="Functor pattern in Python">Next post</a>
            </li>
        </ul></nav>
</div>
    
            <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
            MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
            </script>
</div>

                </div>
                <!--End of body content-->
                <div style="clear:both;height:0;"></div>
            </div>
        </div>

        <!-- Sidebar -->

        <div class=" pure-u-6-24 pure_cell">
            <div id="sidebar">
                <div class="widget">
                    <div id="search_bar">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer">
        Contents © 2017         <a href="mailto:adam@">Adam Saleh</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
        
    </div>

    <!--FIXME: put these somewhere                            -->
    <!--%if len(translations) > 1:-->
    <!--<li>
</li>-->
    <!--%endif-->
    <!--% if show_sourcelink:-->
    <!---->
    <!--%endif-->
    <link href="../../assets/css/duoshuo.css" type="text/css" rel="stylesheet">
<script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</div>
</div>
</body>
</html>
