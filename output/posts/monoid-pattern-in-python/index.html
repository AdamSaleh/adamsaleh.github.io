<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monoid pattern in Python | Adam Saleh's notes</title>
<link href="../../assets/css/theme.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/pure.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://notes.asaleh.net/posts/monoid-pattern-in-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Adam Saleh">
<link rel="prev" href="../functor-pattern-in-python/" title="Functor pattern in Python" type="text/html">
<link rel="next" href="../applicative-pattern-in-python/" title="Applicative pattern in Python" type="text/html">
<meta property="og:site_name" content="Adam Saleh's notes">
<meta property="og:title" content="Monoid pattern in Python">
<meta property="og:url" content="http://notes.asaleh.net/posts/monoid-pattern-in-python/">
<meta property="og:description" content="Monoids are cool¶One useful concept to investigate here is the one of a monoid. 
If we think of this as an interface that is implemented by a type T, it needs two things:

the empty element, usually c">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-11T17:25:47+02:00">
<meta property="article:tag" content="algebraic-patterns">
</head>
<body>
<div class="body_container">
    <div id="header">
        <div class="site-name">
                <a id="logo" href="http://notes.asaleh.net/"><h1>Adam Saleh's notes</h1></a>
        </div>

        <div id="nav-menu">
            <div class="bitcron_nav_container">
                <div class="bitcron_nav">
                    <div class="site_nav_wrap">
                        <ul class="site_nav sm sm-base">
<li><a href="../../pages/about/" class="nav__item">About</a></li>
            <li><a href="../../pages/algebraic-patterns/" class="nav__item">Algebraic patterns</a></li>
            <li><a href="../../archive.html" class="nav__item">Archive</a></li>
            <li><a href="../../categories/" class="nav__item">Tags</a></li>
            <li><a href="../../rss.xml" class="nav__item">RSS feed</a></li>

                            
                        </ul>
<div class="clear clear_nav_inline_end"></div>
                    </div>
                </div>
                <div class="clear clear_nav_end"></div>
            </div>
        </div>
    </div>
    <div id="layout">
        <div class="pure-g">
            <div class=" pure-u-24-24 pure-u-sm-24-24 pure-u-md-18-24 pure_cell">
                <div class="content_container">
                    <!--Body content-->
                    <div class="row">
                        
                        
<div class="post post-page">
    
    <header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Monoid pattern in Python</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Adam Saleh
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-05-11T17:25:47+02:00" itemprop="datePublished" title="2017-05-11 17:25">2017-05-11 17:25</time></a></p>
                <p class="commentline">
        
<a href="%7Blink%7D" onclick="this.href='/posts/monoid-pattern-in-python/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/monoid-pattern-in-python.html</span>
<script>
var idcomments_acct = '1fb78414f6b8ffc05cf0238b6fa4e491';
var idcomments_post_id = "cache/posts/monoid-pattern-in-python.html";
var idcomments_post_url = "/posts/monoid-pattern-in-python/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="post-content">
        <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Monoids-are-cool">Monoids are cool<a class="anchor-link" href="#Monoids-are-cool">¶</a>
</h2>
<p>One useful concept to investigate here is the one of a <em>monoid</em>. 
If we think of this as an interface that is implemented by a type <em>T</em>, it needs two things:</p>
<ul>
<li>the <em>empty</em> element, usually called <em>mempty</em>
</li>
<li>the <em>append</em> operation, that takes any two T's and returns a new T</li>
</ul>
<p>There are three laws:</p>
<ul>
<li>
<em>operation is closed over T</em>: for any two objects of type T it will really return new T, no exceptions. </li>
<li>
<em>identity</em>: for any a of type T: append(a,empty) == append(empty,a) == a</li>
<li>
<em>associativity</em>: for any a,b,c of type T: append(a,append(b,c)) == append(append(a,b),c)</li>
</ul>
<p>Now we have this interface, we can do cool things with this :)</p>
<!-- TEASER_END -->

<p>And by cool thigs, I mean going through <a href="https://www.youtube.com/watch?v=WsA7GtUQeB8">this presentation</a> by Gabriel Gonzalez and translating the concepts from haskell to python :)</p>
<p>If you are not scared of Haskell, I really recomend that presentation. There is even a <a href="https://github.com/Gabriel439/slides/tree/master/lambdaconf/category">souce for it</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="But-first,-semigroups">But first, semigroups<a class="anchor-link" href="#But-first,-semigroups">¶</a>
</h2>
<p>Maybe we are getting ahead of ourselves. What if I don't require the <em>empty</em> element.
Even if I just have a binary operation that abides just by the first to laws,</p>
<ul>
<li>it is <em>closed</em>
</li>
<li>and <em>associative</em>
it still makes it realy nice to work with. The fact that I know it is closed means that I don't have to think about the current values I am going to <em>append</em>, and <em>associavity</em> means that I don't really have to think about the order in which my <em>append</em>s get executed. And less thinking I have to do, the better.</li>
</ul>
<p>This is what we call <em>semigroup</em>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I my mind, the most useful of the laws is requiring the operation to be <em>closed</em>.
Few thing that easily throws wrench into our laws are</p>
<ul>
<li>null</li>
<li>exceptions</li>
<li>non-termination</li>
</ul>
<p>In theory, when you use sufficiently advanced type system, you could forbid some of these.</p>
<p>For example in Haskell, Kotlin, Typescript and even C# you are able to define functions that make it a compile-time error, if you pass in a value that might be null.</p>
<p>In Python, we don't have this available by default. Although I'd like to explore the power of <a href="https://docs.python.org/3/library/typing.html">Python's typing library</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Useful,-but-not-semigroups">Useful, but not-semigroups<a class="anchor-link" href="#Useful,-but-not-semigroups">¶</a>
</h2>
<p>Of course, there are many useful operations on objects, that are not semigroups.
For example, function composition.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="nb">str</span><span class="p">)(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">compose</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="nb">abs</span><span class="p">)(</span><span class="o">-</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>2
10
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function composition is a useful concept, but I just can't compose arbitrary functions together, they have to match.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">compose</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="nb">len</span><span class="p">)(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-6-780387530514&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>compose<span class="ansi-yellow-intense-fg ansi-bold">(</span>len<span class="ansi-yellow-intense-fg ansi-bold">,</span>len<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-cyan-intense-fg ansi-bold">10</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-fg">&lt;ipython-input-5-6bdc4733c056&gt;</span> in <span class="ansi-cyan-fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(x)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-intense-fg ansi-bold">def</span> compose<span class="ansi-yellow-intense-fg ansi-bold">(</span>f<span class="ansi-yellow-intense-fg ansi-bold">,</span>g<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span><span class="ansi-green-intense-fg ansi-bold">return</span> <span class="ansi-green-intense-fg ansi-bold">lambda</span> x<span class="ansi-yellow-intense-fg ansi-bold">:</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span>g<span class="ansi-yellow-intense-fg ansi-bold">(</span>x<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> 
<span class="ansi-green-intense-fg ansi-bold">      4</span> print<span class="ansi-yellow-intense-fg ansi-bold">(</span>compose<span class="ansi-yellow-intense-fg ansi-bold">(</span>len<span class="ansi-yellow-intense-fg ansi-bold">,</span>str<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-cyan-intense-fg ansi-bold">10</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> print<span class="ansi-yellow-intense-fg ansi-bold">(</span>compose<span class="ansi-yellow-intense-fg ansi-bold">(</span>str<span class="ansi-yellow-intense-fg ansi-bold">,</span>abs<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">-</span><span class="ansi-cyan-intense-fg ansi-bold">10</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-fg">TypeError</span>: object of type 'int' has no len()</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is applicable to many concepts in stream processing, or dataflow programming, where there is the concept of <em>piping</em> a stream to transform it for processing. If endpoints of the pipes don't fit together, your pipe-line just won't work. This explains why so much of unix tooling deals with text-to-text transformations. The fact that so many of the utilities are <em>closed</em> over text streams makes their usage much more pleasant.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Some-monoid-examples">Some monoid examples<a class="anchor-link" href="#Some-monoid-examples">¶</a>
</h2>
<p>But if we have a monoid, there are few cool things we can do with it, as shown in <a href="https://www.youtube.com/watch?v=WsA7GtUQeB8">the presentation</a> by Gabriel Gonzalez.</p>
<p>Typeclasses present the first translation hiccup. In haskell you use these to signidy that a type conforms to some interface, similarily to Java/C# interfaces. Nice thing about this is, that you can define implementations for existing types. This makes them more similiar to C# extension methods, or Clojure protocols. Fortunately, we have single dispatch in Python to simulate this.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">singledispatch</span>
<span class="nd">@singledispatch</span>
<span class="k">def</span> <span class="nf">mempty</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Not implemented for"</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>

<span class="nd">@singledispatch</span>
<span class="k">def</span> <span class="nf">mappend</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Not implemented for"</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can definitely implement these for lists.</p>
<ul>
<li>mappend is +, and we know that appending lists is associative</li>
<li>mempty is [], and we know that it doesn't matter if you'd append empty list to left or right</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can definitely implement these for lists.</p>
<ul>
<li>mappend is +, and we know that appending lists is associative</li>
<li>mempty is [], and we know that it doesn't matter if you'd append empty list to left or right</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@mempty</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="nd">@mappend</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mappend</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[15]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[1, 2, 3, 4, 5, 6]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can trivially implement these for None. It might look kind'a silly, but it will be useful, once we get to combine function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@mempty</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="kc">None</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="nd">@mappend</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="kc">None</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mappend</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="kc">None</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[17]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generic-functions">Generic functions<a class="anchor-link" href="#Generic-functions">¶</a>
</h2>
<p>Now we can create a generic function that works on all monoids, such as mconcat, that takes a list and appends its contents.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mconcat</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">mappend</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">acc</span>

<span class="n">mconcat</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-bb9cceb40914&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span class="ansi-green-fg">return</span> acc
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>mconcat<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">5</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-1-bb9cceb40914&gt;</span> in <span class="ansi-cyan-fg">mconcat</span><span class="ansi-blue-fg">(l)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     acc <span class="ansi-blue-fg">=</span> l<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     <span class="ansi-green-fg">for</span> x <span class="ansi-green-fg">in</span> l<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg">         </span>acc <span class="ansi-blue-fg">=</span> mappend<span class="ansi-blue-fg">(</span>acc<span class="ansi-blue-fg">,</span>x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span class="ansi-green-fg">return</span> acc
<span class="ansi-green-intense-fg ansi-bold">      6</span> 

<span class="ansi-red-fg">NameError</span>: name 'mappend' is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, we have run into our first problem. In theory we should be able to do mconcat of an [] and get the mempty for the lists member type. But python doesn't have typed lists. Well, we see how far will this get us :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nesting">Nesting<a class="anchor-link" href="#Nesting">¶</a>
</h2>
<p>Second thing we could do, is to try to nest these inside of other structures.
For example, if you have n-tuple with monoids, you can prove, that the n-tuple is monoid. I am lazy to write out the proof, so I just defer to the presentation I am copying from :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@mappend</span><span class="o">.</span><span class="n">register</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mappend</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mappend</span><span class="p">(([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]),([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[20]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>([1, 2, 3, 4, 5, 6], [10, 11, 12, 14, 15])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This of course means that we can nest the touples in other touples :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mappend</span><span class="p">(([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],([</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">],([</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">],[</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">]))),</span>
       <span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],([</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">],([</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">],[</span><span class="mi">26</span><span class="p">,</span><span class="mi">28</span><span class="p">]))))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[21]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>([1, 2, 3, 4], ([10, 11, 12, 13], ([20, 21, 22, 23], [25, 26, 26, 28])))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nesting-with-functions">Nesting with functions<a class="anchor-link" href="#Nesting-with-functions">¶</a>
</h2>
<p>If we have function f that accepts type A as input param and returns type B, then f forms a semigroup if B forms a semigroup.</p>
<p>Basically, we pass the input into all of the functions and then we append the results.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@mappend</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">mconcat</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">):</span>
    <span class="n">a_r</span><span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="n">b_r</span><span class="o">=</span><span class="n">b</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mappend</span><span class="p">(</span><span class="n">a_r</span><span class="p">,</span><span class="n">b_r</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This means we can send a single arg to multiple functions that return None. This is where the mappend definition comes useful, because without it we would have seen exceptions here.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">phello</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span>
  
<span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"Hi"</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span>

<span class="n">mappend</span><span class="p">(</span><span class="n">phello</span><span class="p">,</span><span class="n">phi</span><span class="p">)(</span><span class="s2">"World!"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Hello World!
Hi World!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Or they could return function that returns None :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">promptName</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Enter Your Name: "</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Hi "</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">promptAge</span><span class="p">():</span>
    <span class="n">age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Enter Your Age: "</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Your Age is"</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>

<span class="n">promptBoth</span> <span class="o">=</span> <span class="n">mappend</span><span class="p">(</span><span class="n">promptName</span><span class="p">,</span><span class="n">promptAge</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">answers</span> <span class="o">=</span> <span class="n">promptBoth</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Enter Your Name: Adam
Enter Your Age: 99
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">answers</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Hi  Adam
Your Age is 99
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We could actually get these back, if we return a monoid from tose inner functions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">getName</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Enter Your Name: "</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">getAge</span><span class="p">():</span>
    <span class="n">age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Enter Your Age: "</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">age</span><span class="p">]</span>

<span class="n">getBoth</span> <span class="o">=</span> <span class="n">mappend</span><span class="p">(</span><span class="n">getName</span><span class="p">,</span><span class="n">getAge</span><span class="p">)</span>
<span class="n">listAnswers</span> <span class="o">=</span> <span class="n">getBoth</span><span class="p">()</span>
<span class="n">listAnswers</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Enter Your Name: Adam
Enter Your Age: 99
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt output_prompt">Out[27]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>['Adam', '99']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Function-nesting-and-laws">Function nesting and laws<a class="anchor-link" href="#Function-nesting-and-laws">¶</a>
</h2>
<p>Lets look again at the most important law that this <code>mappend</code> needs to uphold.</p>

<pre><code>mappend(f, mappend(g,h)) == mappend(mappend(f,g),h)</code></pre>
<p>, given any functions <code>a</code>,<code>b</code>,<code>c</code>, that</p>
<ul>
<li>accept the same input param </li>
<li>and return the same semigroup.</li>
</ul>
<p>To make this more readable, I will use $\oplus$ instead of <code>mappend</code>. This means, that I want to prove
$$ f \oplus (g \oplus h) = (f \oplus g) \oplus h $$</p>
<p>Functions are equivalent when for any input, they produce equal output.</p>
<p>So, lets assume arbitrary input of <code>x</code>, and we will try to evaluate this on the both sides and try get to the same result (we will mark result of $f(x)$ as $f_x$ and we will evaluate the functions from the left):</p>
$$ \begin{align*} (f \oplus (g \oplus h))(x) &amp;= f(x) \oplus (g \oplus h)(x) \\
&amp;= f_x \oplus (g \oplus h) \\
&amp;= f_x \oplus (g(x) \oplus h(x)) \\
&amp;= f_x \oplus (g_x \oplus h(x) )\\
&amp;= f_x \oplus (g_x \oplus h_x)
\end{align*} $$$$ \begin{align*} ((f \oplus g) \oplus h)(x) &amp;= (f \oplus g)(x) \oplus h(x) \\
&amp;= (f(x) \oplus g(x)) \oplus h(x) \\
&amp;= (f_x \oplus g(x)) \oplus h(x) \\
&amp;= (f_x \oplus g_x) \oplus h(x) \\
&amp;= (f_x \oplus g_x) \oplus h_x 
\end{align*} $$<p>Because we know, that $f_x$, $g_x$ and $h_x$ are from the same semigroup, the last lines are equivalent.</p>
<p>There is another assumption, and that is, that the function application will always start at right. This way, no matter the bracket position, $f(x)$ in our example always gets evaluated first.  This is why we can't i.e. flip the evaluation of the functions in our implementation, because ordering matters, and next code sample would introduce a subtle bug.</p>

<pre><code>@mappend.register(mconcat.__class__)
def _(a,b):
  def result(*x):
    b_r = b(*x)
    a_r = a(*x)
    return mappend(a_r,b_r)
  return result</code></pre>
<p>In math, we know that function will always return the same result for the same input, in python this is not the case. This means, that while sketching out a proof is helpful, we can't rely on it too much and still need to be doing testing.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="To-conclude">To conclude<a class="anchor-link" href="#To-conclude">¶</a>
</h2>
<p>I wouldn't actually advise anybody to go overboard with nesting monoids as a basis for extendable and robust application architecture. Well, in Haskell you can have a field day with this, but in Python there isn't the scaffolding of types to keep the madness in check. Which means that I stop here, and don't try to implement monoid for combining streaming transactions :-)</p>
<p>On the other hand, going just slightly over-board with funciton nesting to create a little configuration parsing dsl might be fun. Maybe next time.</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    <div class="postpromonav">
        <nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/algebraic-patterns/" rel="tag">algebraic-patterns</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../functor-pattern-in-python/" rel="prev" title="Functor pattern in Python">Previous post</a>
            </li>
            <li class="next">
                <a href="../applicative-pattern-in-python/" rel="next" title="Applicative pattern in Python">Next post</a>
            </li>
        </ul></nav>
</div>
    <section class="comments hidden-print"><h2>Comments</h2>
        
        
<script>
var idcomments_acct = '1fb78414f6b8ffc05cf0238b6fa4e491';
var idcomments_post_id = "cache/posts/monoid-pattern-in-python.html";
var idcomments_post_url = "http://notes.asaleh.net/posts/monoid-pattern-in-python/";
</script><span id="IDCommentsPostTitle" style="display:none"></span>
<script src="http://www.intensedebate.com/js/genericCommentWrapperV2.js"></script></section><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
            MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
            </script>
</div>

                </div>
                <!--End of body content-->
                <div style="clear:both;height:0;"></div>
            </div>
        </div>

        <!-- Sidebar -->

        <div class=" pure-u-6-24 pure_cell">
            <div id="sidebar">
                <div class="widget">
                    <div id="search_bar">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer">
        Contents © 2017         <a href="mailto:adam@">Adam Saleh</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
        
    </div>

    <!--FIXME: put these somewhere                            -->
    <!--%if len(translations) > 1:-->
    <!--<li>
</li>-->
    <!--%endif-->
    <!--% if show_sourcelink:-->
    <!---->
    <!--%endif-->
    <link href="../../assets/css/duoshuo.css" type="text/css" rel="stylesheet">
<script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</div>
</div>
</body>
</html>
