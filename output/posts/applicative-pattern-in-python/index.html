<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Applicative pattern in Python | Adam Saleh's notes</title>
<link href="../../assets/css/theme.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/pure.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://asaleh.net/posts/applicative-pattern-in-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Adam Saleh">
<link rel="prev" href="../monoid-pattern-in-python/" title="Monoid pattern in Python" type="text/html">
<link rel="next" href="../monoid-for-specifying-configuration/" title="Monoid for specifying configuration" type="text/html">
<meta property="og:site_name" content="Adam Saleh's notes">
<meta property="og:title" content="Applicative pattern in Python">
<meta property="og:url" content="http://asaleh.net/posts/applicative-pattern-in-python/">
<meta property="og:description" content="Applicatives, or functors for arbitrary functions¶Mapping only single param functions can be limiting. It would be cool if lift would could work on function with arbitrary many parameters.
 

But befo">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-11T17:27:58+02:00">
</head>
<body>
<div class="body_container">
    <div id="header">
        <div class="site-name">
                <a id="logo" href="http://asaleh.net/"><h1>Adam Saleh's notes</h1></a>
        </div>

        <div id="nav-menu">
            <div class="bitcron_nav_container">
                <div class="bitcron_nav">
                    <div class="site_nav_wrap">
                        <ul class="site_nav sm sm-base">
<li><a href="../../pages/about/" class="nav__item">About</a></li>
            <li><a href="../../pages/algebraic-patterns/" class="nav__item">Algebraic patterns</a></li>
            <li><a href="../../archive.html" class="nav__item">Archive</a></li>
            <li><a href="../../categories/" class="nav__item">Tags</a></li>
            <li><a href="../../rss.xml" class="nav__item">RSS feed</a></li>

                            
                        </ul>
<div class="clear clear_nav_inline_end"></div>
                    </div>
                </div>
                <div class="clear clear_nav_end"></div>
            </div>
        </div>
    </div>
    <div id="layout">
        <div class="pure-g">
            <div class=" pure-u-24-24 pure-u-sm-24-24 pure-u-md-18-24 pure_cell">
                <div class="content_container">
                    <!--Body content-->
                    <div class="row">
                        
                        
<div class="post post-page">
    
    <header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Applicative pattern in Python</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Adam Saleh
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-05-11T17:27:58+02:00" itemprop="datePublished" title="2017-05-11 17:27">2017-05-11 17:27</time></a></p>
            
        <p class="sourceline"><a href="index.ipynb" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="post-content">
        <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Applicatives,-or-functors-for-arbitrary-functions">Applicatives, or functors for arbitrary functions<a class="anchor-link" href="#Applicatives,-or-functors-for-arbitrary-functions">¶</a>
</h2>
<p>Mapping only single param functions can be limiting. It would be cool if <code>lift</code> would could work on function with arbitrary many parameters.</p>
 <!-- TEASER_END -->

<p>But before we begin with our attempts at solution, we need to define our <code>fmap</code> and <code>lift</code> once again:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">singledispatch</span><span class="p">,</span> <span class="n">partial</span>

<span class="nd">@singledispatch</span>
<span class="k">def</span> <span class="nf">fmap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Not implemented for"</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">lift</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">liftedfn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fmap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">liftedfn</span> 
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we could register a few classes that would work with this.
I.e. all of the collections such as list:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@fmap</span><span class="o">.</span><span class="n">register</span><span class="p">([]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">fn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Could <em>currying</em> rescue us?</p>
<p>Currying is a concept, where instead of passing in all the params into the function at once, you pass in the first param and grt a new function as a result. This function accepts the second param and returns a function that accepts the third, and by now you should be getting a picture.</p>
<p>Or maybe I should show an example.Lets invent a nontrivial 3 arg function, we will call it erm, <code>window</code> (because slice was taken).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">array</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">begin</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

<span class="n">window</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[6]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[3, 4]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If this function were curried, it would look like this:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">curried_window</span><span class="p">(</span><span class="n">begin</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">end</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">array</span><span class="p">:</span> <span class="n">array</span><span class="p">[</span><span class="n">begin</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<span class="n">curried_window</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">4</span><span class="p">)([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[7]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[3, 4]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some functional languages have this as a default. The nice thing about that is, that you can quickly create more specific fuctions, without the need to wrap them in new function definitions.</p>
<p>And this seems to solve out problem with multi param function, because sudenly, everything is a single param function, once you curry :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fmap</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">curried_window</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[9]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;function __main__.curried_window.&lt;locals&gt;.&lt;lambda&gt;&gt;,
 &lt;function __main__.curried_window.&lt;locals&gt;.&lt;lambda&gt;&gt;,
 &lt;function __main__.curried_window.&lt;locals&gt;.&lt;lambda&gt;&gt;,
 &lt;function __main__.curried_window.&lt;locals&gt;.&lt;lambda&gt;&gt;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, as you can see, currying won't save us just yet, because even though we can use map with them,
result is kind-of useless list of functions. We would need to somehow be able to <em>apply</em> this list of functions on a list of values.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@singledispatch</span>
<span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">lfn</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Not implemented for"</span> <span class="o">+</span> <span class="n">lx</span><span class="p">)</span>

<span class="nd">@fmap</span><span class="o">.</span><span class="n">register</span><span class="p">([]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">lfn</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">fn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">lfn</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lx</span><span class="p">]</span>


<span class="n">a0</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">curried_window</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">apply</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="n">a0</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">apply</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
              <span class="p">],</span><span class="n">a1</span><span class="p">)</span>

<span class="n">a2</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[[2, 3, 4, 5],
 [2, 3, 4, 5],
 [2, 3, 4, 5, 6],
 [2, 3, 4, 5, 6],
 [3, 4, 5],
 [3, 4, 5],
 [3, 4, 5, 6],
 [3, 4, 5, 6]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Yay, this seems to have worked :)</p>
<p>Now we can try to combine currying with <em>apply</em> and create a propper lift function :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">curry</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fn</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">partial</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">curry</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">partial</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
    
<span class="k">def</span> <span class="nf">lift</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">lifted</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">result_fn</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">curry</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">fn</span><span class="p">),</span><span class="n">arg0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">result_fn</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">result_fn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_fn</span>
    <span class="k">return</span> <span class="n">lifted</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There is one more assumption we made, when creating this lift function.
On the line where we state:</p>

<pre><code>result = map(curry(len(args)+1, fn),arg0)</code></pre>
<p>we assume that you can use <code>map</code> function on the data-type we are lifting.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">liftedw</span> <span class="o">=</span> <span class="n">lift</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="n">liftedw</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
<span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[14]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[[2, 3, 4, 5],
 [2, 3, 4, 5],
 [2, 3, 4, 5, 6],
 [2, 3, 4, 5, 6],
 [3, 4, 5],
 [3, 4, 5],
 [3, 4, 5, 6],
 [3, 4, 5, 6]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, why to through all of this trouble to get the equivalent of i.e:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">window</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> 
 <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> 
 <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> 
 <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[15]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[[2, 3, 4, 5],
 [2, 3, 4, 5],
 [2, 3, 4, 5, 6],
 [2, 3, 4, 5, 6],
 [3, 4, 5],
 [3, 4, 5],
 [3, 4, 5, 6],
 [3, 4, 5, 6]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I have two reasons:</p>
<ul>
<li>We could use this pattern for things that are not iterable :)</li>
<li>we can analyze the pattern in isolation and figure out interesting relations</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Lifting-values">Lifting values<a class="anchor-link" href="#Lifting-values">¶</a>
</h2>
<p>So far, we were concerned about lifting functions, but we would probably like to be able to lift arbitrary values as well. As you can see in our <code>lifted</code> definition, we have so far assumed, that we are lifting at least an unary function. Because we can't derive the wrapper for values from map and apply, we need to define it for the specific datatype. We uaually call this function <code>pure</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Interesting thing with <code>pure</code> is, that with it defined, we should be able to replace uses of <code>map(fn,o)</code> with <code>apply(pure(fn),o)</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Algebra-behind-the-applicative">Algebra behind the applicative<a class="anchor-link" href="#Algebra-behind-the-applicative">¶</a>
</h2>
<p>So far we have not been explicit about our formal requirements on <code>map</code>, <code>applicative</code> and <code>pure</code>. I have mentioned that <code>map</code> should behave <em>sensible</em> and that there is some relationship between functors, lifting and category theory.</p>
<p>In my mind, the most sensible thing, is to think about functor as a lawful interface. Lawful interface would mean, that it conforms to more requirements, than just the ability to i.e. perform a method call.</p>
<p>A type T describes a functor if:</p>
<ul>
<li>we can consider T a wrapper over arbitrary type A</li>
<li>there is a function <code>map</code>, that<ul>
<li>accepts function <code>f</code>, that accepts <code>a</code> and returns <code>b</code>
</li>
<li>accepts <code>T</code> wrapping <code>a</code>
</li>
<li>returns <code>T</code> wrapping <code>b</code>
</li>
</ul>
</li>
</ul>
<p>In haskell we would say that map has type (a -&gt; b) -&gt; T a -&gt; T b
With <a href="https://docs.python.org/3/library/typing.html">Python's typing library</a> we could say that the type of <code>map</code> is</p>

<pre><code>Callable[[Callable[[A],B], T[A]],T[B]]</code></pre>
<p>The map function then needs to conform to these laws</p>
<ul>
<li>for any t, <code>map(lambda x:x ,t) == t</code>
</li>
<li>for any t and any two composable functions f and g, <code>map(f,map(g,t)) == map(lambda x: f(g(x)),t)</code>
</li>
</ul>
<p>If we define <code>id</code> and <code>compose</code> functions:</p>

<pre><code>def id(x):
  return x

def compose(f,g):
  def composed(x)
    return f(g(x))
  return composed</code></pre>
<p>we can swap the lambda expressions in the laws:</p>
<ul>
<li>for any t, <code>map(id ,t) == t</code>
</li>
<li>for any t and any two composable functions f and g, <code>map(f,map(g,t)) == map(compose(f,g),t)</code>
</li>
</ul>
<p>For applicative, we need it to implement be functor as well as</p>
<ul>
<li>have function <code>pure</code> that accepts arbitrary <code>a</code> and returnt <code>T a</code>
</li>
<li>have function <code>apply</code>, that<ul>
<li>for any function f, that accepts <code>a</code> and returns <code>b</code>
</li>
<li>accepts <code>T</code> wrapping <code>f</code>
</li>
<li>accepts <code>T</code> wrapping <code>a</code>
</li>
<li>returns <code>T</code> wrapping <code>b</code>
</li>
</ul>
</li>
</ul>
<p>In haskell, we would say, that <code>pure</code> has type a -&gt; T a and apply T (a -&gt; b) -&gt; T a -&gt; T b
With <a href="https://docs.python.org/3/library/typing.html">Python's typing library</a> we could say that the type of <code>pure</code> is</p>

<pre><code>Callable[[A], T[A]]</code></pre>
<p>And type of <code>apply</code> is</p>

<pre><code>Callable[[T[Callable[[A],B]], T[A]],T[B]]</code></pre>
<p>The <code>apply</code> and <code>pure</code> functions need to conform to these laws:</p>
<ul>
<li>for any t, <code>apply(pure(id),t) == t</code>
</li>
<li>for any function f and type x, <code>apply(pure(f),pure(x)) == f(x)</code>
</li>
<li>for any t, x, <code>apply(t, pure(x)) == apply(pure(lambda g: g(x)),t)</code>
</li>
<li>for any u,v,w, <code>apply(apply(apply(pure(compose),u),v),w) == apply(u,apply(v,w))</code><ul>
<li>be aware that apply is not required to be associative, i.e. you can't state what ?? should be in <code>apply(apply(u,v),w) ?? apply(u,apply(v,w))</code>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parametrized-lift">Parametrized lift<a class="anchor-link" href="#Parametrized-lift">¶</a>
</h2>
<p>For some of the following examples, I need to be able to lift into different domains. I might want to do this by making the lift function parametrized. We can't unfortunately do this with single dispatch, because the pure function would have nothing to dispatch on. This is similiar to our problem with <code>empty</code> when dealing with monoids.</p>
<p>This is why we will make applicative a class</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Applicative</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">();</span>
    
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">();</span>
        
    <span class="k">def</span> <span class="nf">lift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">lifted</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pure</span><span class="p">(</span><span class="n">curry</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">fn</span><span class="p">)),</span><span class="n">arg0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">lifted</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Because applicatives are not native to python, I am not entirely sure how to best define them. But this way looks simple enough.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Solving-the-null-pointer-exception?">Solving the null-pointer exception?<a class="anchor-link" href="#Solving-the-null-pointer-exception?">¶</a>
</h2>
<p>One thing we could try, is to solve the NPE problem with this. If you think about it, when you have function, that doesn't expect <code>None</code>, but gets it, only reasonable thing we could do with this, is return <code>None</code>.</p>
<p>We can define our wrapper function <code>pure</code> to just return the value back. We wouldn't be able to do this kind of cheating in haskell, where we would need to explicitly box the type. In Python this seems to be working.</p>
<p>We define our apply function to return <code>None</code> if any of the params are <code>None</code>.
We can try this on <code>int</code> function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ApplyNone</span><span class="p">(</span><span class="n">Applicative</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lfn</span><span class="p">,</span><span class="n">lx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lfn</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">lx</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lfn</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">nint</span> <span class="o">=</span> <span class="n">ApplyNone</span><span class="p">()</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can compare:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s2">"1"</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>1
</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-19-0030a6dbdf17&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> print<span class="ansi-blue-fg">(</span>int<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"1"</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>print<span class="ansi-blue-fg">(</span>int<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: int() argument must be a string, a bytes-like object or a number, not 'NoneType'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nint</span><span class="p">(</span><span class="s2">"1"</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nint</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>1
None
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To be honest, this is sort of a toy example. You probably don't want to just wrap your functions with this and instead of error at the place of failure just recieve the propagated nulls everywhere. But we can do better.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Applicative-Validation">Applicative Validation<a class="anchor-link" href="#Applicative-Validation">¶</a>
</h2>
<p>So what about some other uses? One I really like is using applicatives for validation.</p>
<p>First, let me harp on a thing I don't like about <em>exceptions</em>. Once you throw it,
you are aborting the execution. I especially dislike it, if somebody uses exceptions
to validate function params, i.e.:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">validated_window</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">begin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Begin was negative"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"End was not positive"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">window</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">arr</span><span class="p">)</span>

<span class="n">validated_window</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,[])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">Exception</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-21-7d3436bc90f5&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-green-fg">return</span> window<span class="ansi-blue-fg">(</span>begin<span class="ansi-blue-fg">,</span>end<span class="ansi-blue-fg">,</span>arr<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg"> </span>validated_window<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-21-7d3436bc90f5&gt;</span> in <span class="ansi-cyan-fg">validated_window</span><span class="ansi-blue-fg">(begin, end, arr)</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">def</span> validated_window<span class="ansi-blue-fg">(</span>begin<span class="ansi-blue-fg">,</span> end<span class="ansi-blue-fg">,</span> arr<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-green-fg">if</span> begin <span class="ansi-blue-fg">&lt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> Exception<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Begin was negative"</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">if</span> end <span class="ansi-blue-fg">&lt;</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         <span class="ansi-green-fg">raise</span> Exception<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"End was not positive"</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">Exception</span>: Begin was negative</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Exception only told me about the frst problem. But with applicative pattern, I can rewrite it in such way, that I would get all of them.</p>
<p>I will define two validating functions:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">valid_begin</span><span class="p">(</span><span class="n">begin</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">begin</span> <span class="k">if</span> <span class="n">begin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Begin was negative"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">valid_end</span><span class="p">(</span><span class="n">end</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">end</span> <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"End was not positive"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, let me define how would I like to write the validated function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">validated_window</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>    
    <span class="k">return</span> <span class="n">liftedw</span><span class="p">(</span><span class="n">valid_begin</span><span class="p">(</span><span class="n">begin</span><span class="p">),</span><span class="n">valid_end</span><span class="p">(</span><span class="n">end</span><span class="p">),</span><span class="n">arr</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the interesting part of the puzzle is to redefine applyy once again, from thing that processes values in arrays, to thing that can deal with values that might be useless Exceptions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ApplyError</span><span class="p">(</span><span class="n">Applicative</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lfn</span><span class="p">,</span><span class="n">lx</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lfn</span><span class="p">,</span><span class="ne">Exception</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="k">return</span> <span class="ne">Exception</span><span class="p">(</span><span class="o">*</span><span class="n">lfn</span><span class="o">.</span><span class="n">args</span><span class="p">,</span><span class="o">*</span><span class="n">lx</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lfn</span><span class="p">,</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lfn</span>    
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lx</span>
        <span class="k">return</span> <span class="n">lfn</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span>
    
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, there are 3 cases to consider:</p>
<ul>
<li>if both <em>fn</em> and <em>x</em> contain exceptions, I return agregate exception</li>
<li>if <em>fn</em> or <em>x</em> contain exceptions, I return the exception</li>
<li>if none of these happen, I can return <em>fn(x)</em>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">liftedw</span> <span class="o">=</span> <span class="n">ApplyError</span><span class="p">()</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="n">validated_window</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,[])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[25]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>Exception('Begin was negative', 'End was not positive')</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This style of applicative validation is more or less taken from the <a href="https://leanpub.com/purescript/read#leanpub-auto-applicative-validation">Purescript book</a>. There is a difference, in the explicit boxing and unboxing I have mentioned earlier. If we explixitly boxed i.e. the <code>Exception</code> in an object of i.e. <code>Validated</code> class, we might be able to use some nice features of python, like sinlge dispatch. On the other hand, the lack of static type checking means, that the boxing wouldn't really help us.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Applicative-generators">Applicative generators<a class="anchor-link" href="#Applicative-generators">¶</a>
</h2>
<p>In python we have the concept of generator, that just produces a stream values. For example, we could have a infinite stream of positive and negative numbers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">positive</span><span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">yield</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">negative</span><span class="p">():</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">i1</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">yield</span> <span class="n">i</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Previously we created applicative, that would be able to lift iterables/generators by doing the equivalent of:</p>

<pre><code>def apply(wf,wx)
    return [f(x) 
        for f in wf 
        for x in wx]</code></pre>
<p>This would of course only work for generators that end. But we could combne generators in a way that would be equal to:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span><span class="n">wx</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">wx</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, how would we define the <code>pure</code> function? One way might be:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">v</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There is a problem with this definition, though. We want <code>apply(pure(id),t) == t</code>, for any t. And if we try i.e. <code>t = [1, 2, 3]</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">pure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">),[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[35]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[1]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This means that the correct definition for <code>pure</code> will need to be an infinite stream, repeating the value.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ApplyGenerator</span><span class="p">(</span><span class="n">Applicative</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wf</span><span class="p">,</span> <span class="n">wx</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">f</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">wx</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can try this with our window function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [72]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">ApplyGenerator</span><span class="p">()</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">window</span><span class="p">)([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
<span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[72]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[[2, 3, 4, 5], [3, 4, 5, 6]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And it seems that it is working as expected :-)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Composing-applicatives">Composing applicatives<a class="anchor-link" href="#Composing-applicatives">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, after we have defined several somewhat useful applicatives, we can nest them. I am stealing the implementation from the original paper <a href="http://openaccess.city.ac.uk/13222/1/Applicative-final.pdf"> Applicative programming with effects</a> from the part <em>Composing applicative functors</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">containing</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Nested</span><span class="p">(</span><span class="n">Applicative</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">pure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">outer</span><span class="o">.</span><span class="n">pure</span><span class="p">(</span><span class="n">inner</span><span class="o">.</span><span class="n">pure</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lfn</span><span class="p">,</span> <span class="n">lval</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">outer</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">inner</span><span class="o">.</span><span class="n">apply</span><span class="p">)(</span><span class="n">lfn</span><span class="p">,</span><span class="n">lval</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Nested</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can make a i.e. a stream of possible errors.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ListOfValid</span> <span class="o">=</span> <span class="n">containing</span><span class="p">(</span><span class="n">ApplyGenerator</span><span class="p">(),</span> <span class="n">ApplyError</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can see, that this still works with the vaules it have worked previously.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">ListOfValid</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">window</span><span class="p">)([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
<span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[47]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[[2, 3, 4, 5], [3, 4, 5, 6]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But we can try to pass in some <em>error</em> values alongside of the iterables.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">ListOfValid</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">window</span><span class="p">)([</span><span class="mi">1</span><span class="p">,</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">"Begin was negative"</span><span class="p">)],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">"End was not positive"</span><span class="p">)],</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
<span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[75]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[[2, 3, 4, 5], Exception('Begin was negative', 'End was not positive')]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can see that the first values of the iterables were correctly combined into result, and second values that had some errors have the combined error result.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [77]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">ListOfValid</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">window</span><span class="p">)([</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">"Begin was negative"</span><span class="p">),</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">"Begin was negative"</span><span class="p">)],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
<span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[77]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>[Exception('Begin was negative'), Exception('Begin was negative')]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here we have error in both the first and the second and it results in both errors being shown in the resulting stream.</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    <div class="postpromonav">
        <nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../monoid-pattern-in-python/" rel="prev" title="Monoid pattern in Python">Previous post</a>
            </li>
            <li class="next">
                <a href="../monoid-for-specifying-configuration/" rel="next" title="Monoid for specifying configuration">Next post</a>
            </li>
        </ul></nav>
</div>
    
            <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
            MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
            </script>
</div>

                </div>
                <!--End of body content-->
                <div style="clear:both;height:0;"></div>
            </div>
        </div>

        <!-- Sidebar -->

        <div class=" pure-u-6-24 pure_cell">
            <div id="sidebar">
                <div class="widget">
                    <div id="search_bar">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer">
        Contents © 2017         <a href="mailto:adam@">Adam Saleh</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
        
    </div>

    <!--FIXME: put these somewhere                            -->
    <!--%if len(translations) > 1:-->
    <!--<li>
</li>-->
    <!--%endif-->
    <!--% if show_sourcelink:-->
    <!---->
    <!--%endif-->
    <link href="../../assets/css/duoshuo.css" type="text/css" rel="stylesheet">
<script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</div>
</div>
</body>
</html>
